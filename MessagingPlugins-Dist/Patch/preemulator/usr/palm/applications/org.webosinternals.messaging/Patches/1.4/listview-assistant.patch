--- listview-assistant.js	Thu Jan  7 14:45:51 2010
+++ listview-assistant.new	Sat May  1 16:22:41 2010
@@ -35,6 +35,7 @@
 	
 		this.COMMAND_MENU = {
     		loadComposeView: {command:'cmdLoadComposeView',target: this.loadComposeView.bind(this)},
+    		refreshBuddyList: {command:'cmdrefreshBuddyList',target: this.refreshBuddyList.bind(this)},
 	    	loadPreferencesView: {command:Mojo.Menu.prefsCmd,target: this.loadPreferencesView.bind(this)},
     		loadHistoryView: {command:'cmdLoadHistoryView',target: this.loadHistoryView.bind(this)},
     		loadBuddyView: {command: 'cmdLoadBuddyView',target: this.loadBuddyView.bind(this)},
@@ -57,7 +58,8 @@
 		];
 		
 		this.commandMenuModel = [
-			{label:$L('Compose new message'), icon:'newchat', command:this.COMMAND_MENU.loadComposeView.command}
+			{label:$L('Compose new message'), icon:'newchat', command:this.COMMAND_MENU.loadComposeView.command},
+			{label:$L('Compose new message'), icon:'refresh', command:this.COMMAND_MENU.refreshBuddyList.command}
 		];
 
 		this.availabilities = [
@@ -1298,7 +1300,29 @@
 			
 		}
 	},
-	
+	  
+	LoadBuddyList: function(data){
+		var that = this;   
+      		data.list.each(function(item){
+			if (item.availability != "4") {
+				//Load the buddy list
+				MessagingMojoService.refreshBuddyList(that.controller,item.domain,item.username);
+				that.buddyListThrottler.forceUpdate();
+			}
+		});        
+	},
+
+	refreshBuddyList: function() {
+		//Clear the buddy list
+		this.buddyListWidget.mojo.setLength(0);
+		
+		//Make service call to load the buddy list. This causes the list to update
+		MessagingMojoService.getIMAccounts({
+	  		sceneController: this.controller,
+			onSuccess: this.LoadBuddyList.bind(this)
+		});
+	},
+
 	loadComposeView: function(params) {
 		this.controller.stageController.pushScene('compose', params);
 	},
@@ -1386,6 +1410,12 @@
 			this.setAvailabilityIndicator(this.Messaging.Availability.PENDING);
 		} else {
 			this.setAvailabilityIndicator(selectedValue);
+		}
+
+		if (selectedValue ==	this.currentAvailability != this.Messaging.Availability.AVAILABLE)
+		{
+			//Refresh Buddy List
+			this.refreshBuddyList();
 		}
 		
 		MessagingMojoService.setPresence(this.controller, selectedValue, this.handleSetPresenceFailure.bind(this));
